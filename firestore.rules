rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 用户集合：允许公开读取，允许创建和更新（小规模信任场景）
    match /users/{userId} {
      allow read: if true;     // 所有人可查看用户信息
      allow create: if true;   // 允许注册
      allow update: if true;   // 允许更新（包括自己和管理员）
      allow delete: if true;   // 允许删除（包括自己和管理员）
    }
    
    // 旧的submissions集合保留（如果还有遗留数据）
    match /submissions/{submission} {
      allow read: if true;
      allow write: if true;
    }
    
    // 留言集合：允许用户读取发给自己的留言，创建、更新和删除自己发出的留言
    match /messages/{messageId} {
      allow read: if true;  // 允许所有人读取（或限制为 request.auth != null）
      allow create: if true; // 允许创建留言
      allow update, delete: if true; // 允许更新和删除
    }
    
    // 关系集合：允许创建和读取关系申请
    match /relationships/{relationshipId} {
      allow read: if true;  // 允许读取
      allow create: if true; // 允许创建申请
      allow update: if true; // 允许更新状态
      allow delete: if true; // 允许删除
    }

    // 弹幕留言集合：允许所有人读取和创建弹幕
    match /danmaku_messages/{messageId} {
      allow read: if true;   // 允许所有人读取弹幕
      allow create: if true; // 允许创建弹幕
      allow delete: if true; // 允许删除弹幕
    }
  }
}
