<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Movie!</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Lato:wght@300;400&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="./css/styles.css" />
  <!-- æå‰åŠ è½½æ—¶é—´æ„ŸçŸ¥ä¸»é¢˜ï¼Œå‡å°‘é¦–å±é—ªçƒ -->
  <script src="./js/timeTheme.js" defer></script>

  <!-- Firebase SDK (Compat) placed before app scripts) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
</head>
<body>
  <!-- å·¦ä¸Šè§’ç”¨æˆ·å…¥å£ -->
  <div class="user-corner" id="userCorner">
    <!-- æœªç™»å½•æ—¶æ˜¾ç¤ºç«ç„° -->
    <div class="corner-flame" id="cornerFlame" onclick="showLoginModal()">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
        <path d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"/>
      </svg>
    </div>
    
    <!-- ç™»å½•åæ˜¾ç¤ºç”¨æˆ·å¤´åƒ -->
    <div class="corner-avatar" id="cornerAvatar" onclick="toggleUserMenu()" style="display:none;">
      <div class="corner-avatar-img" id="cornerAvatarImg"></div>
      <div class="corner-badge" id="cornerBadge" style="display:none;">0</div>
    </div>
  </div>

  <!-- ç”¨æˆ·ä¸‹æ‹‰èœå• -->
  <div class="user-dropdown" id="userDropdown">
    <div class="user-dropdown-header">
        <div class="dropdown-avatar" id="dropdownAvatar"></div>
        <div class="dropdown-info" style="display:flex; align-items:center; gap:8px; justify-content:space-between; width:100%;">
          <div class="dropdown-nickname" id="dropdownNickname"></div>
          <!-- åå­—å³ä¾§å±•ç¤ºå…³ç³»å¾½æ ‡ï¼ˆ>2 æŠ˜å ä¸º Xä¸ªå…³ç³»ï¼‰ -->
          <div class="dropdown-relations" id="dropdownRelations"></div>
        </div>
    </div>
    <div class="user-dropdown-body">
      <div class="dropdown-info-item">
        <strong>æœ€å–œæ¬¢çš„å¯¼æ¼”ï¼š</strong><span id="dropdownDirector"></span>
      </div>
      <div class="dropdown-info-item">
        <strong>æœ€å–œæ¬¢çš„ç”µå½±ï¼š</strong><span id="dropdownFilm"></span>
      </div>
      <div class="dropdown-badges" id="dropdownBadges"></div>
        <!-- ç”µå½±é£æ ¼ç§»åŠ¨åˆ°å¾½ç« ä¸‹æ–¹ä¸€è¡Œå±•ç¤º -->
        <div class="dropdown-style-below" id="dropdownStyleBelow" style="margin-top:6px; color:#bbb; font-size:13px;"></div>
    </div>
    <div class="user-dropdown-actions">
        <button class="dropdown-btn" onclick="showUserPage(window.currentUser.id)">ğŸ‘¤ æŸ¥çœ‹æˆ‘çš„ä¸»é¡µ</button>
        <button class="dropdown-btn" onclick="editOwnProfile()">âœï¸ ç¼–è¾‘èµ„æ–™</button>
        <button class="dropdown-btn" onclick="showMyMessages()">ğŸ“¬ æŸ¥çœ‹æˆ‘çš„ç•™è¨€ <span id="dropdownMsgPill" style="display:none; margin-left:6px; padding:2px 6px; background:var(--avatar-glow-color); border:1px solid var(--avatar-border-color); color:var(--avatar-border-color); border-radius:10px; font-size:12px;"></span></button>
        <button class="dropdown-btn" onclick="showRelationshipCenter()">ğŸ¤ å…³ç³»å¤„ç† <span id="dropdownRelPill" style="display:none; margin-left:6px; padding:2px 6px; background:var(--avatar-glow-color); border:1px solid var(--avatar-border-color); color:var(--avatar-border-color); border-radius:10px; font-size:12px;"></span></button>
      <button class="dropdown-btn" onclick="showAdminPrompt()">ğŸ‘‘ ç®¡ç†å‘˜æ¨¡å¼</button>
      <button class="dropdown-btn" onclick="logoutUser()">ğŸšª é€€å‡ºç™»å½•</button>
      <button class="dropdown-btn danger" onclick="deleteOwnAccount()">âš ï¸ æ³¨é”€è´¦æˆ·</button>
    </div>
  </div>

  <!-- ç”µå½±èƒ¶ç‰‡èƒŒæ™¯ -->
  <div class="film-strip-background" id="filmBackground"></div>

  <!-- æµåŠ¨è¯—æ„æ’ç‰ˆçš„å¯¼æ¼”åå­— -->
  <div class="directors-layer" id="directorsLayer"></div>

  <!-- å·¦ä¸‹è§’åŠŸèƒ½èœå• -->
  <div class="function-menu-container" id="functionMenuContainer" style="display:none;">
    <!-- ä¸»åŠŸèƒ½é”®ï¼ˆç½‘æ ¼å›¾æ ‡ï¼‰ -->
    <div class="main-function-button" id="mainFunctionButton" onclick="toggleFunctionMenu()" title="åŠŸèƒ½èœå•">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
        <path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/>
      </svg>
      <div class="emoji-hall-badge" id="mainFunctionBadge" style="display:none;">0</div>
    </div>

    <!-- å­åŠŸèƒ½æŒ‰é’®å®¹å™¨ -->
    <div class="sub-function-buttons" id="subFunctionButtons">
      <!-- æµ‹éªŒæŒ‰é’® -->
      <div class="sub-function-button" onclick="startQuiz()" title="å¼€å§‹æµ‹éªŒ">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
          <path d="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"/>
        </svg>
      </div>

      <!-- å‡ºé¢˜æŒ‰é’® -->
      <div class="sub-function-button" onclick="showEmojiCreatePage()" title="å‡ºé¢˜">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
          <path d="M18 4l2 4h-3l-2-4h-2l2 4h-3l-2-4H8l2 4H7L5 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4h-4z"/>
          <path d="M5.5 16c.83 0 1.5-.67 1.5-1.5S6.33 13 5.5 13 4 13.67 4 14.5 4.67 16 5.5 16z"/>
          <path d="M18.5 16c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5-1.5.67-1.5 1.5.67 1.5 1.5 1.5z"/>
        </svg>
      </div>

      <!-- çŒœé¢˜å¤§å…æŒ‰é’® -->
      <div class="sub-function-button" onclick="showEmojiHallPage()" title="çŒœé¢˜å¤§å…">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
          <path d="M9 21h6v-1.5H9V21zm3-19C7.92 2 5 4.92 5 8c0 2.38 1.19 4.47 3 5.74V16c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.08-2.92-6-6-6z"/>
        </svg>
        <div class="emoji-hall-badge" id="emojiHallBadge" style="display:none;">0</div>
      </div>

      <!-- æ’è¡Œæ¦œæŒ‰é’® -->
      <div class="sub-function-button" onclick="showEmojiLeaderboard()" title="æ’è¡Œæ¦œ">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
          <path d="M16 11V3H8v6H2v12h20V11h-6zm-6-6h4v14h-4V5zm-6 6h4v8H4v-8zm16 8h-4v-6h4v6z"/>
        </svg>
      </div>

      <!-- ç•™è¨€å¢™æŒ‰é’® -->
      <div class="sub-function-button" onclick="toggleDanmakuWall()" title="ç•™è¨€å¢™">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
          <path d="M17 10.5V7c0-1.1-.9-2-2-2H5C3.9 5 3 5.9 3 7v10c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-3.5l4 4v-11l-4 4z"/>
        </svg>
        <div class="emoji-hall-badge" id="danmakuBadge" style="display:none;">0</div>
      </div>

      <!-- ç•™ä¸€å¸§æŒ‰é’® -->
      <div class="sub-function-button" onclick="window.leavePotatoFrame && window.leavePotatoFrame()" title="ç•™ä¸€å¸§">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
          <path d="M12 2c-3.86 0-7 2.91-7 6.5 0 4.87 5.4 9.86 6.69 10.95.2.17.42.26.64.26s.44-.09.64-.26C13.6 18.36 19 13.37 19 8.5 19 4.91 15.86 2 12 2zm0 9.5c-.83 0-1.5-.67-1.5-1.5S11.17 8.5 12 8.5s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
        </svg>
      </div>
    </div>
  </div>

  <!-- å¯¼æ¼”å¼¹çª— -->
  <div class="modal" id="directorModal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal()">&times;</span>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- æµ‹éªŒè¦†ç›–å±‚ -->
  <div class="quiz-overlay" id="quizOverlay">
    <!-- æµ‹éªŒé¡µé¢ -->
    <div id="quizPage" class="quiz-container">
      <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
      <div class="question-number" id="questionNumber">é—®é¢˜ 1 / 5</div>
      <div class="question-text" id="questionText"></div>
      <div class="question-image hidden" id="questionImage"><img id="questionImg" alt="question" /></div>
      <div id="answerContainer">
        <input id="answerInput" class="answer-input" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ" />
        <div id="optionsContainer" class="options-container hidden"></div>
      </div>
      <button class="quiz-button" onclick="handleNext()">ä¸‹ä¸€é¢˜</button>
      <button class="quiz-button" onclick="closeQuiz()">å…³é—­</button>
    </div>
  </div>

  <!-- ç™»å½•/æ³¨å†Œæ¨¡æ€æ¡† -->
  <div class="login-modal-overlay" id="loginModalOverlay" onclick="closeLoginModal()"></div>
  <div class="login-modal" id="loginModal">
    <span class="modal-close" onclick="closeLoginModal()">&times;</span>
    
    <!-- ç™»å½•/æ³¨å†Œé€‰æ‹© -->
    <div id="loginChoice" class="login-choice">
      <h2>Welcome!</h2>
      <button class="choice-button" onclick="showRegisterForm()">ğŸ”¥ ç¬¬ä¸€æ¬¡æ¥ï¼Ÿ</button>
      <button class="choice-button" onclick="showLoginForm()">âœ¨ å·²ç»æ¥è¿‡ï¼Ÿ</button>
    </div>

    <!-- ç™»å½•è¡¨å• -->
    <div id="loginForm" class="auth-form hidden">
      <h2>ç™»å½•</h2>
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="loginNickname">æ˜µç§°</label>
          <input id="loginNickname" type="text" required placeholder="è¾“å…¥ä½ çš„æ˜µç§°" />
        </div>
        <div class="form-group">
          <label for="loginPassword">å¯†ç </label>
          <input id="loginPassword" type="password" required placeholder="è¾“å…¥ä½ çš„å¯†ç " />
        </div>
        <button type="submit" class="submit-button">ç™»å½•</button>
        <button type="button" class="back-button" onclick="showLoginChoice()">è¿”å›</button>
      </form>
    </div>

    <!-- æ³¨å†Œè¡¨å• -->
    <div id="registerForm" class="auth-form hidden">
      <h2>æ³¨å†Œ</h2>
      <form onsubmit="handleRegister(event)" id="regForm">
        <!-- å¤´åƒé€‰æ‹©å™¨ -->
        <div class="form-group">
          <label>é€‰æ‹©å¤´åƒ *</label>
          <small>ç‚¹å‡»é€‰æ‹©ï¼Œæœªé€‰æ‹©å°†è‡ªåŠ¨ç”Ÿæˆé¦–å­—æ¯å¤´åƒ</small>
          <div class="avatar-selector" id="avatarSelector"></div>
          <input type="hidden" id="selectedAvatar" value="" />
        </div>

        <!-- æ˜µç§° -->
        <div class="form-group">
          <label for="regNickname">æ˜µç§° *</label>
          <input id="regNickname" type="text" required placeholder="è¾“å…¥ä½ çš„æ˜µç§°" />
        </div>

        <!-- å¯†ç  -->
        <div class="form-group">
          <label for="regPassword">å¯†ç  *</label>
          <input id="regPassword" type="password" required placeholder="è‡³å°‘4ä¸ªå­—ç¬¦" />
        </div>
        <div class="form-group">
          <label for="regPasswordConfirm">ç¡®è®¤å¯†ç  *</label>
          <input id="regPasswordConfirm" type="password" required placeholder="å†æ¬¡è¾“å…¥å¯†ç " />
        </div>

        <!-- æœ€å–œæ¬¢çš„å¥³å¯¼æ¼” -->
        <div class="form-group">
          <label for="favoriteDirector">æœ€å–œæ¬¢çš„å¥³å¯¼æ¼” *</label>
          <input id="favoriteDirector" type="text" required placeholder="å¦‚ï¼šé˜¿æ¶…æ–¯Â·ç“¦å°”è¾¾" />
        </div>

        <!-- æœ€å–œæ¬¢çš„å¥³æ€§ç”µå½± -->
        <div class="form-group">
          <label for="favoriteFilm">æœ€å–œæ¬¢çš„å¥³æ€§ç”µå½± *</label>
          <input id="favoriteFilm" type="text" required placeholder="å¦‚ï¼šç‡ƒçƒ§å¥³å­çš„è‚–åƒ" />
        </div>

        <!-- æœ€è¿‘çœ‹çš„ç”µå½±ï¼ˆå¯é€‰ï¼‰ -->
        <div class="form-group">
          <label for="recentFilm">æœ€è¿‘çœ‹çš„ä¸€éƒ¨ç”µå½±ï¼ˆå¯é€‰ï¼‰</label>
          <input id="recentFilm" type="text" placeholder="å¦‚ï¼šé˜¿æ¶…æ–¯è®ºç“¦å°”è¾¾" />
        </div>

        <!-- åˆ†äº«æƒ³æ³•ï¼ˆå¯é€‰ï¼‰ -->
        <div class="form-group">
          <label for="thoughts">åˆ†äº«ä½ æœ€è¿‘å¥½ç©çš„æƒ³æ³•ï¼ˆå¯é€‰ï¼‰</label>
          <textarea id="thoughts" rows="3" placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•..."></textarea>
        </div>

        <button type="submit" class="submit-button">æ³¨å†Œ</button>
        <button type="button" class="back-button" onclick="showLoginChoice()">è¿”å›</button>
      </form>
    </div>
  </div>

  <!-- ç”¨æˆ·é¡µé¢æ¨¡æ€æ¡† -->
  <div class="user-modal-overlay" id="userModalOverlay" onclick="closeUserModal()"></div>
  <div class="user-modal" id="userModal">
    <span class="modal-close" onclick="closeUserModal()">&times;</span>
    <div id="userContent" class="user-content"></div>
  </div>
  <!-- å·¦å³åˆ‡æ¢æŒ‰é’®ï¼ˆç‹¬ç«‹äºæ¨¡æ€æ¡†ï¼Œé¿å…è¢«overflowè£å‰ªï¼‰ -->
  <div class="user-chevron prev" onclick="userChevronPrev()" aria-label="ä¸Šä¸€ä½">&lt;</div>
  <div class="user-chevron next" onclick="userChevronNext()" aria-label="ä¸‹ä¸€ä½">&gt;</div>

  <!-- ç”¨æˆ·åˆ—è¡¨ä¾§è¾¹æ  -->
  <div class="users-sidebar-overlay" id="usersSidebarOverlay" onclick="closeUsersSidebar()"></div>
  <div class="users-sidebar" id="usersSidebar">
    <div id="usersSidebarGrid" class="sidebar-users-grid"></div>
  </div>
  <!-- å³ä¾§æ ‡ç­¾æŒ‰é’®ï¼šç‚¹å‡»åˆ‡æ¢ä¾§è¾¹æ  -->
  <div class="users-sidebar-tab" id="usersSidebarTab" onclick="toggleUsersSidebarTab()" title="ç”¨æˆ·åˆ—è¡¨">&lt;</div>

  <!-- æˆ‘çš„ç•™è¨€é¡µé¢ -->
  <div class="my-messages-overlay" id="myMessagesOverlay" onclick="closeMyMessages()"></div>
  <div class="my-messages-page" id="myMessagesPage">
    <div class="messages-header">
      <h2>æˆ‘æ”¶åˆ°çš„ç•™è¨€</h2>
      <span class="modal-close" onclick="closeMyMessages()">&times;</span>
    </div>
    <div id="myMessagesList" class="messages-list"></div>
  </div>

  <!-- å…³ç³»ä¸­å¿ƒé¡µé¢ï¼ˆæŸ¥çœ‹å·²å»ºç«‹ä¸å¾…å¤„ç†ã€ä»¥åŠå¤„ç†æ“ä½œï¼‰ -->
  <div class="my-messages-overlay" id="relationshipCenterOverlay" onclick="closeRelationshipCenter()"></div>
  <div class="my-messages-page" id="relationshipCenterPage">
    <div class="messages-header">
      <h2>å…³ç³»ä¸­å¿ƒ</h2>
      <span class="modal-close" onclick="closeRelationshipCenter()">&times;</span>
    </div>
    <div id="relationshipCenterContent" class="messages-list"></div>
  </div>

  <!-- åŠ è½½æç¤º -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <div class="loading-text">åŠ è½½ä¸­...</div>
    </div>
  </div>

  <!-- å¾½ç« æç¤ºæ°”æ³¡ -->
  <div class="badge-toast hidden" id="badgeToast">
    <span class="badge-icon-toast" id="badgeToastIcon"></span>
    <span id="badgeToastText"></span>
    <button id="badgeToastAction" class="badge-toast-action hidden" type="button"></button>
  </div>

  <!-- ç®¡ç†å‘˜å¯†ç è¾“å…¥å¼¹çª— -->
  <div class="admin-prompt-overlay" id="adminPromptOverlay" onclick="closeAdminPrompt()"></div>
  <div class="admin-prompt" id="adminPrompt">
    <h3>è¾“å…¥ç®¡ç†å‘˜å¯†ç </h3>
    <input type="password" id="adminPasswordInput" placeholder="å¯†ç " />
    <div class="admin-prompt-buttons">
      <button onclick="confirmAdminPassword()">ç¡®å®š</button>
      <button onclick="closeAdminPrompt()">å–æ¶ˆ</button>
    </div>
  </div>

  <!-- å…³ç³»ç”³è¯·å¼¹çª—ï¼ˆé€‰æ‹©å…³ç³»ç±»å‹ + è¾“å…¥ç•™è¨€ï¼‰ -->
  <div class="relationship-prompt-overlay" id="relationshipPromptOverlay" onclick="closeRelationshipPrompt()"></div>
  <div class="relationship-prompt" id="relationshipPrompt">
    <h3>å»ºç«‹å…³ç³»</h3>
    <p style="font-size: 14px; color: #888; margin-bottom: 20px;">è¯·é€‰æ‹©ä¸€ä¸ªå…³ç³»ç±»å‹ï¼š</p>
    
    <!-- å…³ç³»ç±»å‹é€‰æ‹©æŒ‰é’®ï¼ˆå·²æ›¿æ¢ä¸ºå…­ç§æ–°å…³ç³»ï¼‰ -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
      <button class="relationship-type-btn" onclick="selectRelationshipType('eternal')" data-type="eternal">
        <div style="font-size: 28px; margin-bottom: 6px;">ğŸª¢</div>
        <div style="font-size: 14px; font-weight: 600;">Eternal Bond</div>
      </button>
      <button class="relationship-type-btn" onclick="selectRelationshipType('backforth')" data-type="backforth">
        <div style="font-size: 28px; margin-bottom: 6px;">ğŸ¸</div>
        <div style="font-size: 14px; font-weight: 600;">Back and Forth</div>
      </button>
      <button class="relationship-type-btn" onclick="selectRelationshipType('investor')" data-type="investor">
        <div style="font-size: 28px; margin-bottom: 6px;">ğŸ’¸</div>
        <div style="font-size: 14px; font-weight: 600;">Angel Investor</div>
      </button>
      <button class="relationship-type-btn" onclick="selectRelationshipType('teddy')" data-type="teddy">
        <div style="font-size: 28px; margin-bottom: 6px;">ğŸ§¸</div>
        <div style="font-size: 14px; font-weight: 600;">Needy Teddy</div>
      </button>
      <button class="relationship-type-btn" onclick="selectRelationshipType('time')" data-type="time">
        <div style="font-size: 28px; margin-bottom: 6px;">â³</div>
        <div style="font-size: 14px; font-weight: 600;">Time Needed</div>
      </button>
      <button class="relationship-type-btn" onclick="selectRelationshipType('blah')" data-type="blah">
        <div style="font-size: 28px; margin-bottom: 6px;">ğŸ’¬</div>
        <div style="font-size: 14px; font-weight: 600;">Blah Blah</div>
      </button>
    </div>

    <!-- ç•™è¨€è¾“å…¥æ¡† -->
    <p style="font-size: 14px; color: #888; margin-bottom: 8px;">ç”³è¯·ç•™è¨€ï¼ˆå¿…å¡«ï¼‰ï¼š</p>
    <textarea id="relationshipMessage" placeholder="è¯´è¯´ä½ ä¸ºä»€ä¹ˆæƒ³ä¸å¯¹æ–¹å»ºç«‹è¿™ç§å…³ç³»..." 
              style="width: 100%; height: 80px; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f5f5f5; font-family: 'Lato', sans-serif; resize: vertical; margin-bottom: 16px;"></textarea>

    <!-- æ“ä½œæŒ‰é’® -->
    <div style="display: flex; gap: 10px; justify-content: flex-end;">
      <button onclick="closeRelationshipPrompt()" style="padding: 10px 20px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: #ccc; border-radius: 8px; cursor: pointer; font-size: 14px;">å–æ¶ˆ</button>
      <button onclick="submitRelationshipRequest(window._selectedRelationType)" style="padding: 10px 20px; background: var(--avatar-glow-color); border: 1px solid var(--avatar-border-color); color: var(--avatar-border-color); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">å‘é€ç”³è¯·</button>
    </div>
  </div>

  <!-- è§£é™¤å…³ç³»å¼¹çª—ï¼ˆè¾“å…¥åŸå› ï¼‰ -->
  <div class="relationship-prompt-overlay" id="dissolvePromptOverlay" onclick="closeDissolvePrompt()"></div>
  <div class="relationship-prompt" id="dissolvePrompt">
    <h3>è§£é™¤å…³ç³»</h3>
    <p style="font-size: 14px; color: #888; margin-bottom: 20px;">è¯·è¯´æ˜è§£é™¤å…³ç³»çš„åŸå› ï¼š</p>
    <textarea id="dissolveReasonInput" placeholder="è¾“å…¥è§£é™¤åŸå› ï¼ˆå¯é€‰ï¼‰..." 
      style="width: 100%; min-height: 100px; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #f5f5f5; font-size: 14px; resize: vertical; font-family: 'Lato', sans-serif; margin-bottom: 20px;"></textarea>
    <div style="display: flex; gap: 10px; justify-content: flex-end;">
      <button onclick="closeDissolvePrompt()" style="padding: 10px 20px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: #ccc; border-radius: 8px; cursor: pointer; font-size: 14px;">å–æ¶ˆ</button>
      <button onclick="submitDissolveRequest()" style="padding: 10px 20px; background: rgba(255,68,68,0.2); border: 1px solid rgba(255,68,68,0.4); color: #ff4444; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">ç¡®è®¤è§£é™¤</button>
    </div>
  </div>

  <!-- åˆ é™¤è´¦æˆ·ç¡®è®¤å¼¹çª— -->
  <div class="admin-prompt-overlay" id="deleteAccountOverlay" onclick="closeDeleteAccountPrompt()"></div>
  <div class="admin-prompt" id="deleteAccountPrompt">
    <h3 style="color: #ff4444; font-size: 18px;">âš ï¸ æ³¨é”€è´¦æˆ·</h3>
    <p id="deleteAccountMessage" style="color: #ccc; margin: 20px 0; line-height: 1.6;"></p>
    <div style="display: flex; gap: 12px;">
      <button onclick="closeDeleteAccountPrompt()" style="flex: 1; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: #ccc; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">å–æ¶ˆ</button>
      <button onclick="confirmDeleteAccount()" style="flex: 1; padding: 12px; background: rgba(255,68,68,0.25); border: 1px solid rgba(255,68,68,0.5); color: #ff4444; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">ç¡®è®¤æ³¨é”€</button>
    </div>
  </div>

  <!-- åˆ é™¤æ‰€æœ‰å¼¹å¹•ç¡®è®¤å¼¹çª— -->
  <div class="admin-prompt-overlay" id="deleteAllDanmakuOverlay" onclick="closeDeleteAllDanmakuPrompt()"></div>
  <div class="admin-prompt" id="deleteAllDanmakuPrompt">
    <h3 style="color: #ff4444; font-size: 18px;">ğŸ—‘ï¸ åˆ é™¤æˆ‘çš„æ‰€æœ‰å¼¹å¹•</h3>
    <p style="color: #ccc; margin: 20px 0; line-height: 1.6;">
      ç¡®å®šè¦åˆ é™¤ä½ å‘é€çš„æ‰€æœ‰å¼¹å¹•ç•™è¨€å—ï¼Ÿ<br/>
      <strong style="color: #ff8888;">æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼</strong>
    </p>
    <p id="deleteAllDanmakuCount" style="color: var(--avatar-border-color); margin: 10px 0; font-size: 14px; text-align: center; transition: color 2s ease;"></p>
    <div style="display: flex; gap: 12px;">
      <button onclick="closeDeleteAllDanmakuPrompt()" style="flex: 1; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: #ccc; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">å–æ¶ˆ</button>
      <button onclick="confirmDeleteAllDanmaku()" style="flex: 1; padding: 12px; background: rgba(255,68,68,0.25); border: 1px solid rgba(255,68,68,0.5); color: #ff4444; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">ç¡®è®¤åˆ é™¤</button>
    </div>
  </div>

  <!-- å¼¹å¹•å¢™è¦†ç›–å±‚ -->
  <div class="danmaku-wall-overlay" id="danmakuWallOverlay">
    <!-- é¡¶éƒ¨æ§åˆ¶æ ï¼ˆå»é™¤æ ‡é¢˜å’Œåˆ†å‰²çº¿ï¼Œä»…iconæŒ‰é’®ï¼‰ -->
    <div class="danmaku-header" style="border-bottom:none;background:transparent;padding:20px 40px 0 40px;">
      <div class="danmaku-controls" style="gap:12px;">
        <button id="danmakuPauseBtn" onclick="toggleDanmakuPause()" title="Pause/Play" style="width:40px;height:40px;padding:0;display:flex;align-items:center;justify-content:center;background:var(--avatar-glow-color);border:1px solid var(--avatar-border-color);border-radius:50%;color:var(--avatar-border-color);cursor:pointer;transition:all 0.3s ease;">
          <svg id="danmakuPauseIcon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor" style="width:20px;height:20px;">
            <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
          </svg>
        </button>
        <button id="danmakuReplayBtn" onclick="replayDanmaku()" title="Replay" style="width:40px;height:40px;padding:0;display:flex;align-items:center;justify-content:center;background:var(--avatar-glow-color);border:1px solid var(--avatar-border-color);border-radius:50%;color:var(--avatar-border-color);cursor:pointer;transition:all 0.3s ease;">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor" style="width:20px;height:20px;">
            <path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6 0 1.3-.42 2.5-1.13 3.47l1.46 1.46C19.07 16.07 20 14.13 20 12c0-4.42-3.58-8-8-8zm-6.87.13L3.13 6.54C2.42 7.5 2 8.7 2 10c0 4.42 3.58 8 8 8v4l5-5-5-5v4c-3.31 0-6-2.69-6-6 0-1.3.42-2.5 1.13-3.47z"/>
          </svg>
        </button>
        <button id="danmakuDeleteAllBtn" onclick="showDeleteAllDanmakuPrompt()" title="Delete All My Messages" style="width:40px;height:40px;padding:0;display:flex;align-items:center;justify-content:center;background:rgba(255,68,68,0.15);border:1px solid rgba(255,68,68,0.4);border-radius:50%;color:#ff4444;cursor:pointer;transition:all 0.3s ease;">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor" style="width:20px;height:20px;">
            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
          </svg>
        </button>
        <button class="modal-close" onclick="closeDanmakuWall()" title="Close" style="width:40px;height:40px;padding:0;display:flex;align-items:center;justify-content:center;background:var(--avatar-glow-color);border:1px solid var(--avatar-border-color);border-radius:50%;color:var(--avatar-border-color);cursor:pointer;transition:all 0.3s ease;">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor" style="width:20px;height:20px;">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- å¼¹å¹•å®¹å™¨ -->
    <div class="danmaku-container" id="danmakuContainer">
      <!-- å¼¹å¹•ä¼šåŠ¨æ€æ’å…¥è¿™é‡Œ -->
    </div>

    <!-- åº•éƒ¨è¾“å…¥åŒº -->
    <div class="danmaku-input-area">
      <div class="danmaku-user-avatar" id="danmakuUserAvatar">
        <!-- æ˜¾ç¤ºå½“å‰ç”¨æˆ·å¤´åƒ -->
      </div>
      <input
        type="text"
        id="danmakuInput"
        placeholder="è¯´ç‚¹ä»€ä¹ˆ..."
        maxlength="50"
      />
      <button onclick="sendDanmaku()">å‘é€</button>
    </div>
  </div>

  <!-- Emojiæ¸¸æˆ - å‡ºé¢˜é¡µ -->
  <div class="emoji-create-overlay" id="emojiCreateOverlay" style="display:none;">
    <div class="emoji-create-page">
      <span class="modal-close" onclick="closeEmojiCreatePage()">&times;</span>
      <h2 style="font-family: 'Playfair Display', serif; font-size: 36px; margin-bottom: 20px; color: var(--avatar-border-color); transition: color 2s ease;">å‡ºé¢˜</h2>

      <!-- å…¬å…±ï¼šé€‰æ‹©ç”µå½±å -->
      <div style="margin-bottom: 20px;">
        <label style="display: block; font-size: 14px; margin-bottom: 10px; color: #ccc;">ç”µå½±å <span style="color: #ff4444;">*</span></label>
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
          <div id="randomTitleDisplay" style="flex: 1; background: rgba(255,255,255,0.05); border: 1px solid var(--avatar-border-color); border-radius: 8px; padding: 12px 15px; color: var(--avatar-border-color); font-size: 16px; font-weight: 500; transition: all 2s ease;"></div>
          <button id="refreshTitleBtn" onclick="refreshRandomTitle()" style="padding: 12px 20px; background: var(--avatar-glow-color); border: 1px solid var(--avatar-border-color); color: var(--avatar-border-color); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease, background 2s ease, border-color 2s ease;">ğŸ”„ æ¢ä¸€ä¸ª</button>
        </div>
        <input type="text" id="customTitleInput" placeholder="æˆ–è€…è¾“å…¥è‡ªå®šä¹‰ç”µå½±å..." style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 12px 15px; color: #f5f5f5; font-size: 14px;" />
      </div>

      <div class="quiz-type-tabs" style="margin-bottom: 18px; display:flex; gap:10px;">
        <button id="createTabEmoji" class="quiz-type-tab-btn active" onclick="switchCreateQuizType('emoji')">Emoji</button>
        <button id="createTabStill" class="quiz-type-tab-btn" onclick="switchCreateQuizType('still')">å‰§ç…§</button>
      </div>

      <div id="emojiCreateSection">
        <div style="margin-bottom: 30px;">
          <label style="display: block; font-size: 14px; margin-bottom: 10px; color: #ccc;">ç”¨emojiè¡¨è¾¾è¿™éƒ¨ç”µå½± (1-6ä¸ª) <span style="color: #ff4444;">*</span></label>
          <input type="text" id="emojiInput" placeholder="è¾“å…¥1-6ä¸ªemoji..." style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 12px 15px; color: #f5f5f5; font-size: 24px;" />
          <div id="emojiValidationMsg" style="margin-top: 8px; font-size: 13px; color: #ff4444; min-height: 18px;"></div>
          <!-- Emoji åˆ†ç±»é¢æ¿ -->
          <div id="emojiPicker" class="emoji-picker">
            <div class="emoji-picker-tabs" id="emojiPickerTabs"></div>
            <div class="emoji-picker-controls">
              <input id="emojiPickerSearch" type="text" placeholder="æœç´¢è¡¨æƒ…..." aria-label="æœç´¢è¡¨æƒ…" />
              <div class="emoji-picker-pager">
                <button id="emojiPagerPrev" type="button">â€¹</button>
                <span id="emojiPagerInfo">1 / 1</span>
                <button id="emojiPagerNext" type="button">â€º</button>
              </div>
            </div>
            <div class="emoji-picker-grid" id="emojiPickerGrid"></div>
          </div>
        </div>

        <div style="display: flex; gap: 12px; justify-content: flex-end;">
          <button onclick="closeEmojiCreatePage()" style="padding: 12px 24px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: #ccc; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">å–æ¶ˆ</button>
          <button id="publishPuzzleBtn" onclick="publishPuzzleUI()" disabled style="padding: 12px 24px; background: var(--avatar-glow-color); border: 1px solid var(--avatar-border-color); color: var(--avatar-border-color); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease, background 2s ease, border-color 2s ease; opacity: 0.5;">å‘å¸ƒé¢˜ç›®</button>
        </div>
      </div>

      <div id="stillCreateSection" style="display:none;">
        <div style="margin-bottom: 24px;">
          <label style="display:block; font-size:14px; margin-bottom:10px; color:#ccc;">å‰§ç…§å›¾ç‰‡ <span style="color:#ff4444;">*</span></label>
          <input type="file" id="stillImageInput" accept="image/*" style="margin-bottom:10px;" />
          <small style="display:block; color:#888; margin-top:4px;">ä¸Šä¼ åå°†è‡ªåŠ¨å‹ç¼©ï¼šæœ€é•¿è¾¹ 1280pxï¼ˆå¯èƒ½é™åˆ° 1024ï¼‰ï¼Œç›®æ ‡ 200â€“600KBï¼Œç¡¬ä¸Šé™ 800KBï¼›ä¼šé¢å¤–ç”Ÿæˆ 480px ç¼©ç•¥å›¾</small>
        </div>

        <div id="stillPreviewContainer" class="still-preview" style="margin-bottom:20px;">
          <img id="stillPreviewImage" alt="still preview" />
          <div id="stillGridOverlay" class="still-grid"></div>
          <div class="still-preview-hint">ç‚¹å‡»æ ¼å­æ·»åŠ é®æŒ¡ï¼Œè‡³å°‘ä¿ç•™ 3 ä¸ªäº®æ ¼</div>
        </div>

        <div style="margin-bottom: 20px;">
          <label style="display:block; font-size:14px; margin-bottom:10px; color:#ccc;">æç¤ºï¼ˆå¯é€‰ï¼‰</label>
          <input type="text" id="stillHintInput" placeholder="å†™ä¸€ä¸ªæç¤ºï¼Œç•™ç©ºåˆ™æ— æç¤º" style="width:100%; background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.2); border-radius:8px; padding:12px 15px; color:#f5f5f5; font-size:14px;" />
        </div>

        <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top:20px;">
          <button onclick="closeEmojiCreatePage()" style="padding: 12px 24px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: #ccc; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">å–æ¶ˆ</button>
          <button id="publishStillBtn" onclick="publishStillPuzzleUI()" disabled style="padding: 12px 24px; background: var(--avatar-glow-color); border: 1px solid var(--avatar-border-color); color: var(--avatar-border-color); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease, background 2s ease, border-color 2s ease; opacity:0.5;">å‘å¸ƒå‰§ç…§é¢˜</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Emojiæ¸¸æˆ - å¤§å…é¡µ -->
  <div class="emoji-hall-overlay" id="emojiHallOverlay" style="display:none;">
    <div class="emoji-hall-page">
      <div class="emoji-hall-header">
        <div style="display: flex; align-items: center; gap: 12px;">
          <h2 style="font-family: 'Playfair Display', serif; font-size: 36px; color: var(--avatar-border-color); transition: color 2s ease; margin: 0;">çŒœé¢˜å¤§å…</h2>
          <button class="emoji-hall-leaderboard-btn" onclick="showEmojiLeaderboard()" title="æ’è¡Œæ¦œ">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
              <path d="M16 11V3H8v6H2v12h20V11h-6zm-6-6h4v14h-4V5zm-6 6h4v8H4v-8zm16 8h-4v-6h4v6z"/>
            </svg>
          </button>
        </div>
        <span class="modal-close" onclick="closeEmojiHallPage()">&times;</span>
      </div>
      <div class="quiz-type-tabs" style="margin-bottom:14px; display:flex; gap:10px; justify-content:center;">
        <button id="hallTabEmoji" class="quiz-type-tab-btn active" onclick="switchHallQuizType('emoji')">
          Emoji
          <span id="hallTabEmojiBadge" class="quiz-type-tab-badge" style="display:none;">0</span>
        </button>
        <button id="hallTabStill" class="quiz-type-tab-btn" onclick="switchHallQuizType('still')">
          å‰§ç…§
          <span id="hallTabStillBadge" class="quiz-type-tab-badge" style="display:none;">0</span>
        </button>
      </div>

      <div id="emojiHallSection">
        <div class="emoji-hall-tabs">
          <button id="hallTabOpenBtn" class="emoji-hall-tab-btn active" onclick="switchHallTab('open')">æœªçŒœå‡º</button>
          <button id="hallTabSolvedBtn" class="emoji-hall-tab-btn" onclick="switchHallTab('solved')">å·²çŒœå‡º</button>
        </div>
        <div id="emojiHallList" class="emoji-hall-list">
          <!-- é¢˜ç›®åˆ—è¡¨åŠ¨æ€æ’å…¥ -->
        </div>
      </div>

      <div id="stillHallSection" style="display:none;">
        <div class="emoji-hall-tabs">
          <button id="stillHallTabOpenBtn" class="emoji-hall-tab-btn active" onclick="switchStillHallTab('open')">æœªçŒœå‡º</button>
          <button id="stillHallTabSolvedBtn" class="emoji-hall-tab-btn" onclick="switchStillHallTab('solved')">å·²çŒœå‡º</button>
        </div>
        <div id="stillHallList" class="emoji-hall-list">
          <!-- å‰§ç…§é¢˜ç›®åˆ—è¡¨ -->
        </div>
      </div>
    </div>
  </div>

  <!-- Emojiæ¸¸æˆ - çŒœé¢˜å¼¹çª— -->
  <div class="emoji-guess-overlay" id="emojiGuessOverlay" style="display:none;">
    <div class="emoji-guess-modal">
      <span class="modal-close" onclick="closeEmojiGuessModal()">&times;</span>
      <div id="emojiGuessContent">
        <!-- çŒœé¢˜å†…å®¹åŠ¨æ€æ’å…¥ -->
      </div>
    </div>
  </div>

  <!-- å‰§ç…§ç©æ³• - çŒœé¢˜å¼¹çª— -->
  <div class="emoji-guess-overlay" id="stillGuessOverlay" style="display:none;">
    <div class="emoji-guess-modal">
      <span class="modal-close" onclick="closeStillGuessModal()">&times;</span>
      <div id="stillGuessContent">
        <!-- å‰§ç…§çŒœé¢˜å†…å®¹ -->
      </div>
    </div>
  </div>

  <!-- Emojiæ¸¸æˆ - æ’è¡Œæ¦œé¡µ -->
  <div class="emoji-leaderboard-overlay" id="emojiLeaderboardOverlay" style="display:none;">
    <div class="emoji-leaderboard-page">
      <div class="emoji-hall-header">
        <h2 style="font-family: 'Playfair Display', serif; font-size: 36px; color: var(--avatar-border-color); transition: color 2s ease;">æ’è¡Œæ¦œ</h2>
        <span class="modal-close" onclick="closeEmojiLeaderboard()">&times;</span>
      </div>

      <div class="quiz-type-tabs" style="display:flex; gap:10px; margin-bottom:16px; justify-content:center;">
        <button id="leaderboardTabEmoji" class="quiz-type-tab-btn active" onclick="switchLeaderboardQuizType('emoji')">Emoji</button>
        <button id="leaderboardTabStill" class="quiz-type-tab-btn" onclick="switchLeaderboardQuizType('still')">å‰§ç…§</button>
      </div>

      <!-- Tab åˆ‡æ¢æŒ‰é’® -->
      <div id="emojiLeaderboardSection">
        <div class="leaderboard-tabs" style="display: flex; gap: 12px; margin-bottom: 24px; justify-content: center;">
          <button id="guessTabBtn" class="leaderboard-tab-btn active" onclick="switchLeaderboardTab('guess')" style="padding: 10px 24px; background: var(--avatar-glow-color); border: 2px solid var(--avatar-border-color); color: var(--avatar-border-color); border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; transition: all 0.3s ease;">
            çŒœå¯¹æ¦œ
          </button>
          <button id="influenceTabBtn" class="leaderboard-tab-btn" onclick="switchLeaderboardTab('influence')" style="padding: 10px 24px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.2); color: #ccc; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; transition: all 0.3s ease;">
            å½±å“åŠ›æ¦œ
          </button>
        </div>

        <div id="emojiLeaderboardList" class="emoji-leaderboard-list">
          <!-- æ’è¡Œæ¦œåˆ—è¡¨åŠ¨æ€æ’å…¥ -->
        </div>
      </div>

      <div id="stillLeaderboardSection" style="display:none;">
        <div class="leaderboard-tabs" style="display: flex; gap: 12px; margin-bottom: 24px; justify-content: center;">
          <button id="stillGuessTabBtn" class="leaderboard-tab-btn active" onclick="switchStillLeaderboardTab('guess')" style="padding: 10px 24px; background: var(--avatar-glow-color); border: 2px solid var(--avatar-border-color); color: var(--avatar-border-color); border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; transition: all 0.3s ease;">
            çŒœå¯¹æ¦œ
          </button>
          <button id="stillInfluenceTabBtn" class="leaderboard-tab-btn" onclick="switchStillLeaderboardTab('influence')" style="padding: 10px 24px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.2); color: #ccc; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; transition: all 0.3s ease;">
            å½±å“åŠ›æ¦œ
          </button>
        </div>
        <div id="stillLeaderboardList" class="emoji-leaderboard-list">
          <!-- å‰§ç…§æ’è¡Œæ¦œ -->
        </div>
      </div>
  </div>
</div>

  <!-- åœŸè±†æ¡Œå® å±‚ -->
  <div class="potato-layer" id="potatoLayer">
    <div class="potato-pet" id="potatoPet" data-variant="seed" data-eyes="open">
      <svg viewBox="0 0 160 160" aria-label="potato pet">
        <defs>
          <style>
            .p-outline { fill: #2a170f; }
            .p-seed-base { fill: #6b3f2a; }
            .p-seed-mid { fill: #8a5a3c; }
            .p-seed-hi { fill: #caa07a; }
            .p-seed-shadow { fill: #4a2b1d; }
            .p-seed-dent { fill: #2d180f; }
            .p-seed-speck { fill: #7c4b33; }

            .p-pot-base { fill: #a07045; }
            .p-pot-mid { fill: #c69263; }
            .p-pot-hi { fill: #f0d3ad; }
            .p-pot-shadow { fill: #7c4f2f; }
            .p-pot-dent { fill: #4a2d1a; }
            .p-pot-speck { fill: #8a5a3b; }

            .p-heart-base { fill: #b07549; }
            .p-heart-mid { fill: #d39b69; }
            .p-heart-hi { fill: #ffe4c8; }
            .p-heart-shadow { fill: #835233; }
            .p-heart-dent { fill: #4b2c19; }
            .p-heart-speck { fill: #956042; }

            .p-eye { fill: #0b1020; }
          </style>
        </defs>
        <g transform="scale(5)" shape-rendering="crispEdges">
          <!-- â‘  ç§å­ -->
          <g class="potato-body seed-body">
            <!-- å‚ç…§potato.htmlåƒç´ é£å°ç§å­å½¢çŠ¶ï¼Œæ¤­åœ†+é«˜å…‰+å‡¹ç‚¹+æ–‘ç‚¹ -->
            <ellipse cx="16" cy="17" rx="7.5" ry="6.5" class="p-seed-base"/>
            <ellipse cx="16" cy="17" rx="7.5" ry="6.5" class="p-outline" fill="none" stroke="#2a170f" stroke-width="1.2"/>
            <ellipse cx="16" cy="17" rx="6.2" ry="5.2" class="p-seed-mid"/>
            <rect x="14" y="11" width="6" height="2" class="p-seed-hi"/>
            <rect x="12" y="13" width="4" height="2" class="p-seed-hi" opacity="0.85"/>
            <rect x="10" y="17" width="3" height="2" class="p-seed-shadow"/>
            <rect x="20" y="17" width="3" height="2" class="p-seed-shadow"/>
            <rect x="15" y="21" width="3" height="2" class="p-seed-dent"/>
            <rect x="14" y="19" width="2" height="1" class="p-seed-speck"/>
            <rect x="18" y="16" width="2" height="1" class="p-seed-speck"/>
          </g>

          <!-- â‘¡ å‘èŠ½ -->
          <g class="potato-body sprout-body">
            <!-- å‚ç…§potato.htmlå‘èŠ½åœŸè±†ï¼Œæ¤­åœ†æ›´ç˜¦å°ï¼Œé¡¶éƒ¨ç•™èŠ½ç©ºé—´ -->
            <ellipse cx="16" cy="18" rx="10.5" ry="8.5" class="p-pot-base"/>
            <ellipse cx="16" cy="18" rx="10.5" ry="8.5" class="p-outline" fill="none" stroke="#2a190f" stroke-width="1.2"/>
            <ellipse cx="16" cy="18" rx="9.2" ry="7.2" class="p-pot-mid"/>
            <rect x="12" y="11" width="6" height="2" class="p-pot-hi"/>
            <rect x="11" y="13" width="4" height="2" class="p-pot-hi" opacity="0.85"/>
            <rect x="22" y="15" width="3" height="2" class="p-pot-shadow"/>
            <rect x="18" y="20" width="4" height="2" class="p-pot-dent"/>
            <rect x="12" y="22" width="2" height="1" class="p-pot-speck"/>
            <rect x="22" y="21" width="2" height="1" class="p-pot-speck"/>
          </g>

          <!-- â‘¢ æˆç†Ÿ -->
          <g class="potato-body normal-body">
            <!-- å‚ç…§potato.htmlæ™®é€šåœŸè±†ï¼Œæ›´åœ†æ¶¦é¥±æ»¡ -->
            <ellipse cx="16" cy="18" rx="12.2" ry="9.6" class="p-pot-base"/>
            <ellipse cx="16" cy="18" rx="12.2" ry="9.6" class="p-outline" fill="none" stroke="#2a190f" stroke-width="1.2"/>
            <ellipse cx="16" cy="18" rx="11" ry="8.2" class="p-pot-mid"/>
            <rect x="10" y="10" width="7" height="3" class="p-pot-hi"/>
            <rect x="9" y="13" width="5" height="2" class="p-pot-hi" opacity="0.85"/>
            <rect x="23" y="14" width="4" height="3" class="p-pot-shadow"/>
            <rect x="18" y="22" width="4" height="3" class="p-pot-dent"/>
            <rect x="21" y="24" width="3" height="2" class="p-pot-dent"/>
            <rect x="10" y="22" width="2" height="1" class="p-pot-speck"/>
            <rect x="24" y="24" width="2" height="1" class="p-pot-speck"/>
          </g>

          <!-- â‘£ çˆ±å¿ƒ -->
          <g class="potato-body heart-body">
            <!-- å‚ç…§potato.htmlçš„çˆ±å¿ƒåœŸè±†ï¼Œåº•éƒ¨æ›´åœ†æ»‘ï¼ˆå¦‚éœ€æ›´æ”¹å½¢çŠ¶å¯è°ƒæ•´path/ellipseå‚æ•°ï¼‰ -->
            <path class="p-outline" d="M16 18 C16 10, 32 10, 32 20 C32 30, 16 38, 16 44 C16 38, 0 30, 0 20 C0 10, 16 10, 16 18 Z"/>
            <path class="p-heart-base" d="M16 19 C16 12, 30 12, 30 20 C30 28, 16 36, 16 42 C16 36, 2 28, 2 20 C2 12, 16 12, 16 19 Z"/>
            <path class="p-heart-mid" d="M16 20 C16 14, 28 14, 28 20 C28 26, 16 34, 16 40 C16 34, 4 26, 4 20 C4 14, 16 14, 16 20 Z"/>
            <rect x="11" y="13" width="6" height="3" class="p-heart-hi"/>
            <rect x="10" y="16" width="4" height="2" class="p-heart-hi" opacity="0.85"/>
            <rect x="23" y="15" width="3" height="2" class="p-heart-shadow"/>
            <rect x="20" y="22" width="4" height="3" class="p-heart-dent"/>
            <rect x="13" y="22" width="3" height="2" class="p-heart-dent"/>
            <rect x="12" y="23" width="2" height="1" class="p-heart-speck"/>
            <rect x="20" y="22" width="2" height="1" class="p-heart-speck"/>
          </g>

          <!-- èŠ½ -->
          <g class="potato-sprout">
            <rect x="15" y="3" width="2" height="8" fill="#166534"/>
            <rect x="15" y="3" width="2" height="4" fill="#22c55e"/>
            <rect x="13" y="4" width="4" height="2" fill="#4ade80"/>
            <rect x="12" y="5" width="2" height="2" fill="#bbf7d0"/>
            <rect x="17" y="5" width="2" height="2" fill="#bbf7d0"/>
          </g>

          <!-- çœ¼ç› -->
          <g class="potato-eyes eyes-open">
            <!-- çœ¼ç›ï¼šå¦‚éœ€è°ƒæ•´é—´è·/å¤§å°å¯æ”¹cx/cy/rå‚æ•° -->
            <circle cx="14" cy="20" r="2.2" class="p-eye"/>
            <circle cx="26" cy="20" r="2.2" class="p-eye"/>
          </g>
          <g class="potato-eyes eyes-closed">
            <!-- çœ¯çœ¼ï¼šå¦‚éœ€è°ƒæ•´é—´è·/é•¿åº¦å¯æ”¹x/widthå‚æ•° -->
            <rect x="12" y="20" width="5" height="1" class="p-eye"/>
            <rect x="23" y="20" width="5" height="1" class="p-eye"/>
          </g>
        </g>
      </svg>
    </div>
    <div class="potato-bubble" id="potatoBubble" role="status" aria-live="polite"></div>
    <!-- åƒç´ é£ç›¸æœºé—ªçƒ -->
    <div id="potatoCameraFlash" style="position:absolute;left:0;top:0;pointer-events:none;opacity:0;">
        <rect x="2" y="7" width="24" height="13" fill="#222" stroke="#fff7" stroke-width="2"/>
        <rect x="6" y="11" width="6" height="6" fill="#444"/>
        <rect x="13" y="12" width="8" height="7" fill="#888"/>
        <rect x="18" y="9" width="4" height="4" fill="#fff"/>
        <rect x="8" y="9" width="3" height="2" fill="#fff"/>
        <rect x="20" y="15" width="2" height="2" fill="#fff"/>
        <rect x="4" y="9" width="2" height="2" fill="#fff"/>
      </svg>
    </div>
  </div>

  <!-- é€šç”¨ç¡®è®¤å¯¹è¯æ¡† -->
  <div class="confirm-dialog-overlay" id="confirmDialogOverlay"></div>
  <div class="confirm-dialog" id="confirmDialog">
    <h3 id="confirmDialogTitle" style="font-size: 18px; color: #f5f5f5; margin-bottom: 20px;">ç¡®è®¤æ“ä½œ</h3>
    <p id="confirmDialogMessage" style="color: #ccc; margin-bottom: 24px; line-height: 1.6;"></p>
    <div style="display: flex; gap: 12px; justify-content: flex-end;">
      <button id="confirmDialogCancelBtn" style="padding: 10px 24px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); color: #ccc; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">å–æ¶ˆ</button>
      <button id="confirmDialogConfirmBtn" style="padding: 10px 24px; background: var(--avatar-glow-color); border: 1px solid var(--avatar-border-color); color: var(--avatar-border-color); border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600;">ç¡®å®š</button>
    </div>
  </div>

  <!-- App Scripts: æ³¨æ„é¡ºåºï¼Œéæ¨¡å—ï¼Œå…¨å±€æš´éœ² -->
  <script src="./js/config.js"></script>
  <script src="./js/data.js"></script>
  <script src="./js/firebase.js"></script>
  <script src="./js/ui.js"></script>
  <script src="./js/quiz.js"></script>
  <script src="./js/user.js"></script>
  <script src="./js/admin.js"></script>
  <script src="./js/gestures.js"></script>
  <script src="./js/messages.js"></script>
  <script src="./js/potatoPet.js"></script>
  <script src="./js/danmaku.js"></script>
  <script src="./js/emojiQuiz.js?v=5"></script>
  <script src="./js/emojiQuizUI.js?v=5"></script>
  <script src="./js/stillQuiz.js?v=5"></script>
  <script src="./js/stillQuizUI.js?v=5"></script>
  <script>
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function(){
      if (window.initAvatarSelector) window.initAvatarSelector();
      if (window.initGestures) window.initGestures();
      if (window.initUserCorner) window.initUserCorner();
      if (window.initUsersSidebarTab) window.initUsersSidebarTab();
      if (window.initTimeTheme) window.initTimeTheme();
      if (window.initEmojiQuizUI) window.initEmojiQuizUI();
      if (window.initStillQuizUI) window.initStillQuizUI();
      if (window.initPotatoPet) window.initPotatoPet();
    });
  </script>
</body>
</html>
